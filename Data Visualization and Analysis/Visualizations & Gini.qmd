---
title: "Data Visualizations and Gini Coefficients"
author: "Luke Fischer"
format: html
editor: visual
---

## Load Packages & Set Seed

```{r}
library(tidyverse)
library(ggplot2)
library(DescTools)
library(broom)
library(knitr)
library(gtExtras)
library(REAT)
library(boot)
set.seed(7)
```

## General Data Wrangling

```{r}
resat <- read_csv("clean_data.csv")

resat <- resat |> 
  mutate(Time_Stamp = as.factor(Time_Stamp), 
         Attribution_Presence = as.factor(Attribution_Presence), 
         Evaluation = as.factor(Evaluation), 
         Topic = as.factor(Topic), 
         Target = as.factor(Target)) |> 
  mutate(Time_Stamp = fct_recode(Time_Stamp, 
                                 "Before" = "0", 
                                 "After" = "1"), 
         Topic = fct_recode(Topic, 
                            "Economy" = "1", 
                            "Social Politices & Welfare" = "2", 
                            "Politics & Human Rights" = "3", 
                            "External Relations" = "4"), 
         Attribution_Presence = fct_recode(Attribution_Presence, 
                                           "Posts without attribution" = "0",
                                           "Posts with attribution" = "1" 
                                           ), 
         Evaluation = fct_recode(Evaluation, 
                                           "Negative" = "0",
                                           "Positive" = "1" 
         ), 
         Target = fct_recode(Target, 
                             "Individual" = "1", 
                             "Collective" = "2", 
                             "System" = "3", 
                             "Network" = "4")
         )


resat1 <- resat |> 
  mutate(Attribution_Presence = 
           if_else(Sender_Relevance != 1 | is.na(Evaluation) | is.na(Topic), "Posts without attribution", Attribution_Presence))  |> 
  group_by(Post_ID) |> 
  mutate(n = row_number(Attribution_Presence)) |> 
  ungroup() |> 
  filter(n == 1)


resat2 <- resat |> 
  filter(Sender_Relevance == 1 & !is.na(Evaluation) & !is.na(Topic)) 
```

## Setting General Visual Theme

```{r}
theme_set(theme_minimal() + 
            theme(text = element_text(family = "Times New Roman"), 
                  legend.position = "bottom"))
```

## RQ1a

**To what extent does the proportion of posts containing responsibility attributions for voting issues vary?**

Cross-Tab:

```{r}
resat1 |> 
  group_by(Time_Stamp) |> 
  count(Attribution_Presence) |> 
  ungroup() |> 
  pivot_wider(
    names_from = Attribution_Presence, 
    values_from = n
  ) |> 
  gt() |> 
  gtsave("RQ1a.png", path = '/Users/lukefischer/Desktop')

```

Proportional Indication:

```{r}
resat1 |> 
  group_by(Time_Stamp) |> 
  count(Attribution_Presence) |>
  mutate(Proportion = n/sum(n))
```

Visualization of RQ1a

```{r}
RQ1aplot <- resat1 |> 
  ggplot(aes(x = Time_Stamp, fill = Attribution_Presence)) + 
  geom_bar(position= "fill",  width = 0.4) + 
  coord_flip() + 
  labs(
    title = "RQ1a",
    x = "Inauguration", 
    y = "Proportion", 
    fill = "Post Type"
  )+
  scale_x_discrete(labels = c("Before", "After")) +
  scale_fill_manual( 
                    values = c("royalblue1", "violet"), guide = guide_legend(reverse = TRUE)) +
  annotate(
    geom = "label", 
    x = "After", 
    y = 0.9225, 
    label = "15,5%", 
    hjust = "center", 
    size = 3
  ) + 
  annotate(
    geom = "label", 
    x = "After", 
    y = 0.4225,
    label = "84,5%", 
    hjust = "center", 
    size = 3
  )+ 
  annotate(
    geom = "label", 
    x = "Before", 
    y = 0.9215,
    label = "15,7%", 
    hjust = "center", 
    size = 3
  )+ 
  annotate(
    geom = "label", 
    x = "Before", 
    y = 0.4215,
    label = "84,3%", 
    hjust = "center", 
    size = 3
  ) +
  theme(plot.title.position = "plot",           
        legend.key.width = unit(1, 'cm'), 
        legend.key.height = unit(0.2, 'cm'))

ggsave("RQ1aplot.png", plot = RQ1aplot, path = '/Users/lukefischer/Desktop', width = 8, height= 3, units = "in")

```

## RQ1b

**RQ1b: To what extent does the proportion of responsibility attribution evaluations vary?**

Cross Tab

```{r}
resat2 |> 
  group_by(Time_Stamp) |> 
  count(Evaluation) |> 
  ungroup() |> 
  pivot_wider(
    names_from = Evaluation, 
    values_from = n
  ) |> 
  gt() |> 
  gtsave("RQ1b.png", path = '/Users/lukefischer/Desktop')
```

Proportional Indication

```{r}
resat2 |> 
  group_by(Time_Stamp) |> 
  count(Evaluation) |> 
  mutate(Proportion = n/sum(n))
```

Visualization

```{r}
RQ1bplot <- resat2 |> 
  ggplot(aes(x = Time_Stamp, fill = Evaluation)) + 
  geom_bar(position= "fill",  width = 0.4) + 
  coord_flip() + 
  labs(
    title = "RQ1b",
    x = "Inauguration", 
    y = "Proportion" 
  ) +
  scale_x_discrete(labels = c("Before", "After")) +
  scale_fill_manual(labels = c("Negative", "Positive"), values = c("#EB442C", "#29AF34"), , guide = guide_legend(reverse = TRUE)) +
  annotate(
    geom = "label", 
    x = "After", 
    y = 0.3045, 
    label = "60,9%", 
    hjust = "center", 
    size = 3
  ) + 
  annotate(
    geom = "label", 
    x = "After", 
    y = 0.8045,
    label = "39,1%", 
    hjust = "center", 
    size = 3
)+ 
  annotate(
    geom = "label", 
    x = "Before", 
    y = 0.2635,
    label = "52.7%", 
    hjust = "center", 
    size = 3
  )+ 
  annotate(
    geom = "label", 
    x = "Before", 
    y = 0.7635,
    label = "47,3%", 
    hjust = "center", 
    size = 3
  ) +
  theme(plot.title.position = "plot", 
        legend.key.width = unit(1, 'cm'), 
        legend.key.height = unit(0.2, 'cm'))

ggsave("RQ1bplot.png", plot = RQ1bplot, path = '/Users/lukefischer/Desktop', width = 8, height= 3, units = "in")

```

## RQ2a

**RQ2a: To what extent does the diversity of individual actor targets of negative responsibility attributions for voting issues vary?**

Proportional Indication

```{r}
prop_rq2a <- resat2 |> 
  filter(Evaluation == "Negative" & Target == "Individual") |> 
  group_by(Time_Stamp) |> 
  count(Specific_Individual) |> 
  mutate(Proportion = n/sum(n)) |> 
  ungroup()

missing <- tibble(
  Time_Stamp = c("After", "After"), 
  Specific_Individual = c("Hillary Clinton", "Other Individual Republican Politicians"), 
  n = c(0, 0), 
  Proportion = c(0, 0)
)

prop_rq2a <- bind_rows(prop_rq2a, missing) |> 
  mutate(Specific_Individual = as.factor(Specific_Individual)) 
```

Cross Tab

```{r}

prop_rq2a |> 
  select(!Proportion) |> 
  pivot_wider(
    names_from = Specific_Individual, 
    values_from = n
  ) |> 
  gt() |> 
  gtsave("RQ2a.png", path = '/Users/lukefischer/Desktop')


```

Visualization

```{r}

RQ2aplot <- resat2 |> 
  filter(Evaluation == "Negative" & Target == "Individual") |> 
  ggplot(aes(x = Time_Stamp, fill = fct_infreq(Specific_Individual))) + 
  geom_bar(position= "dodge",  width = 0.4) +
  scale_fill_discrete(labels = 
                        c("Hillary Clinton", "Barack Obama", "Other Dems", "Other", "Other Reps")) +
  labs(
    title = "RQ2a", 
    x = "Inauguration", 
    fill = "Individuals"
  )+
  theme(plot.title.position = "plot", 
        legend.key.width = unit(1, 'cm'), 
        legend.key.height = unit(0.2, 'cm'))
  

ggsave("RQ2aplot.png", plot = RQ2aplot, path = '/Users/lukefischer/Desktop', width = 8, height= 3, units = "in")


```

Gini Coefficient Before & After

```{r}
lorenz_neg_before_ind <- prop_rq2a |> 
  group_by(Time_Stamp) |> 
  filter(Time_Stamp == "Before") |> 
  ungroup() |> 
  arrange(n) |> 
  select(n) 

gini_neg_before_ind <- lorenz_neg_before_ind |> 
  pull(n)
  
w_neg_before_ind <- c(1, 1, 1, 0.2, 1)

Gini(gini_neg_before_ind, weights = w_neg_before_ind, conf.level = 0.95, R = 10000)

lorenz_neg_after_ind <- prop_rq2a |> 
  group_by(Time_Stamp) |> 
  filter(Time_Stamp == "After") |> 
  ungroup() |> 
  arrange(n) |> 
  select(n) 

gini_neg_after_ind <- lorenz_neg_after_ind |> 
  pull(n)

w_neg_after_ind <- c(1, 1, 0.2, 1, 1)

Gini(gini_neg_after_ind, weights = w_neg_before_ind, conf.level = 0.95, R = 10000)
```

Lorenz Curves Overlayed

```{r}
lorenz(gini_neg_before_ind, weighting = w_neg_before_ind, lc.col= "violet")

lorenz(gini_neg_after_ind, weighting = w_neg_after_ind, add.lc = TRUE)
```

## RQ2b

**To what extent does the diversity of individual actor targets of positive responsibility attributions for voting issues vary?**

Proportion Indicator

```{r}
prop_rq2b <- resat2 |> 
  filter(Evaluation == "Positive" & Target == "Individual") |> 
  group_by(Time_Stamp) |> 
  count(Specific_Individual) |> 
  mutate(Proportion = n/sum(n)) |> 
  ungroup() |> 
  mutate(Specific_Individual = if_else(Specific_Individual == "European politicians and EU politicians (e.g. Ursula Von der Leyen)", "EU/European politician", Specific_Individual))

missing2b <- tibble(
  Time_Stamp = c("Before", "Before", "Before","After", "After"), 
  Specific_Individual = c("Xi Jinping","EU/European politician", "Vladimir Putin", "Hillary Clinton", "Mike Pence"), 
  n = c(0,0, 0, 0, 0), 
  Proportion = c(0,0, 0, 0, 0)
)

prop_rq2b <- bind_rows(prop_rq2b, missing2b) |> 
  mutate(Specific_Individual = as.factor(Specific_Individual)) 
```

Cross Tab

```{r}
prop_rq2b |> 
  select(!Proportion) |> 
  pivot_wider(
    names_from = Specific_Individual, 
    values_from = n
  ) |> 
  gt() |> 
  gtsave("RQ2b.png", path = '/Users/lukefischer/Desktop')

```

Visualization

```{r}
RQ2bplot <- resat2 |> 
  mutate(Specific_Individual = if_else(Specific_Individual == "European politicians and EU politicians (e.g. Ursula Von der Leyen)", "EU/European politician", Specific_Individual)) |> 
  filter(Evaluation == "Positive" & Target == "Individual") |> 
  ggplot(aes(x = Time_Stamp, fill = fct_infreq(Specific_Individual))) + 
  geom_bar(position= "dodge",  width = 0.4) +
  #scale_fill_discrete(labels = 
                        #c()) +
  labs(
    title = "RQ2b", 
    x = "Inauguration", 
    fill = "Individuals"
  )+
  theme(plot.title.position = "plot", 
        legend.key.width = unit(1, 'cm'), 
        legend.key.height = unit(0.2, 'cm'))
  

ggsave("RQ2bplot.png", plot = RQ2aplot, path = '/Users/lukefischer/Desktop', width = 8, height= 3, units = "in")

```

Gini Coefficient Before & After

```{r}
lorenz_pos_before_ind <- prop_rq2b |> 
  group_by(Time_Stamp) |> 
  filter(Time_Stamp == "Before") |> 
  ungroup() |> 
  arrange(n) |> 
  select(n)

gini_pos_before_ind <- lorenz_pos_before_ind |> 
  pull(n)
  
w_neg_before_ind <- c(1, 1, 1, 1,1, 1, 0.125, 1)

DescTools::Gini(gini_pos_before_ind, weights = w_neg_before_ind, conf.level = 0.95, R = 10000)

lorenz_pos_after_ind <- prop_rq2b |> 
  group_by(Time_Stamp) |> 
  filter(Time_Stamp == "After") |> 
  ungroup() |> 
  arrange(n) |> 
  select(n) 

gini_pos_after_ind <- lorenz_pos_after_ind |> 
  pull(n)

w_neg_after_ind <- c(1, 1, 1, 0.125, 1, 1, 1, 1)

Gini(gini_pos_after_ind, weights = w_neg_after_ind, conf.level = 0.95, R = 10000)
```

Lorenz Curves Overlayed

```{r}


lorenz(gini_pos_before_ind, weighting = w_neg_before_ind, lc.col= "violet")

lorenz(gini_pos_after_ind, weighting = w_neg_after_ind, add.lc = TRUE)


```

## RQ3a

**To what extent does the diversity of collective actor targets of negative responsibility attributions for voting issues vary?**

```{r}
prop_rq3a <- resat2 |> 
  filter(Evaluation == "Negative" & Target == "Collective") |> 
  group_by(Time_Stamp) |> 
  count(Specific_Collective) |> 
  mutate(Proportion = n/sum(n)) |> 
  ungroup() |> 
  mutate(Specific_Collective = as.factor(Specific_Collective)) |> 
  mutate(Specific_Collective = fct_recode(Specific_Collective, 
                                          "Media" = "Media (e.g., Fake News)", 
                                          "Minorities" = "Minority Groups (e.g. Immigrants, Queer People)", 
                                          "Other Collectives" = "Other Collectives (e.g. Other Countries, Other Political Groups, NGOs, Public Enterprises, International Governing Institutions)", 
                                          "Progressives" = "Progressive: Democrats/Liberals/Left-wing ideologists", 
                                          "The Obama-Administration" = "The Obama-Administration", 
                                          "Conservatives" = "Conservative: Republicans/Right-wing ideologists", 
                                          "National Government Agencies" = "National Government Agencies (e.g., intelligence agencies, government departments like the department of justice)",
                                          "USA" = "USA"
                                          )) 

missing3a <- tibble(
  Time_Stamp = c("After", "Before", "Before", "Before"), 
  Specific_Collective = c("Minorities", "National Government Agencies", "USA", "Conservatives"), 
  n = c(0, 0, 0, 0), 
  Proportion = c(0, 0, 0, 0)
)

prop_rq3a <- bind_rows(prop_rq3a, missing3a)
```

Cross Tab

```{r}
prop_rq3a |> 
  select(!Proportion) |> 
  pivot_wider(
    names_from = Specific_Collective, 
    values_from = n
  ) |> 
  gt() |> 
  gtsave("RQ3a.png", path = '/Users/lukefischer/Desktop')

```

Data Visualization

```{r}
RQ3aplot <- resat2 |>
  mutate(Specific_Collective = as.factor(Specific_Collective)) |> 
  mutate(Specific_Collective = fct_recode(Specific_Collective, 
                                          "Media" = "Media (e.g., Fake News)", 
                                          "Minorities" = "Minority Groups (e.g. Immigrants, Queer People)", 
                                          "Other Collectives" = "Other Collectives (e.g. Other Countries, Other Political Groups, NGOs, Public Enterprises, International Governing Institutions)", 
                                          "Progressives" = "Progressive: Democrats/Liberals/Left-wing ideologists", 
                                          "The Obama-Administration" = "The Obama-Administration", 
                                          "Conservatives" = "Conservative: Republicans/Right-wing ideologists", 
                                          "National Government Agencies" = "National Government Agencies (e.g., intelligence agencies, government departments like the department of justice)",
                                          "USA" = "USA"
                                          )) |> 
  filter(Evaluation == "Negative" & Target == "Collective") |> 
  ggplot(aes(x = Time_Stamp, fill = fct_infreq(Specific_Collective))) + 
  geom_bar(position= "dodge",  width = 0.4) +
  #scale_fill_discrete(labels = 
                        #c()) +
  labs(
    title = "RQ3a", 
    x = "Inauguration", 
    fill = "Collectives"
  )+
  theme(plot.title.position = "plot", 
        legend.key.width = unit(1, 'cm'), 
        legend.key.height = unit(0.2, 'cm'))


ggsave("RQ3aplot.png", plot = RQ3aplot, path = '/Users/lukefischer/Desktop', width = 8, height= 3, units = "in")
```

Gini Coefficient Before & After

```{r}
lorenz_neg_before_col <- prop_rq3a |> 
  group_by(Time_Stamp) |> 
  filter(Time_Stamp == "Before") |> 
  ungroup() |> 
  arrange(n) |> 
  select(n) 

gini_neg_before_col <- lorenz_neg_before_col |> 
  pull(n)
  
w_neg_before_col <- c(1, 1, 1, 1, 1, 1, 1, 0.125)

DescTools::Gini(gini_neg_before_col, weights = w_neg_before_ind, conf.level = 0.95, R = 10000)

lorenz_neg_after_col <- prop_rq3a |> 
  group_by(Time_Stamp) |> 
  filter(Time_Stamp == "After") |> 
  ungroup() |> 
  arrange(n) |> 
  select(n) 

gini_neg_after_col <- lorenz_neg_after_col |> 
  pull(n)

w_neg_after_col <- c(1, 1, 0.125, 1, 1, 1, 1, 1)

DescTools::Gini(gini_neg_after_col, weights = w_neg_after_ind, conf.level = 0.95, R = 10000)
```

Lorenz Curves Overlayed

```{r}

lorenz(gini_neg_before_col,w_neg_before_col, lc.col= "violet")

lorenz(gini_neg_after_col,w_neg_after_col, add.lc = TRUE)
```

## RQ3b

**To what extent does the diversity of collective actor targets of positive responsibility attributions for voting issues vary?**

Proportional Indicator

```{r}
prop_rq3b <- resat2 |> 
  filter(Evaluation == "Positive" & Target == "Collective") |> 
  group_by(Time_Stamp) |> 
  count(Specific_Collective) |> 
  mutate(Proportion = n/sum(n)) |> 
  ungroup() |> 
  mutate(Specific_Collective = as.factor(Specific_Collective)) |> 
  mutate(Specific_Collective = fct_recode(Specific_Collective, 
                                          "The Trump-Administration" = "The Trump-Administration", 
                                          "Other Collectives" = "Other Collectives (e.g. Other Countries, Other Political Groups, NGOs, Public Enterprises, International Governing Institutions)", 
                                          
                                          "Conservatives" = "Conservative: Republicans/Right-wing ideologists", 
                                          "National Government Agencies" = "National Government Agencies (e.g., intelligence agencies, government departments like the department of justice)",
                                          "USA" = "USA"
                                          )) 

missing3b <- tibble(
  Time_Stamp = c("Before", "Before"), 
  Specific_Collective = c("USA", "National Government Agencies"), 
  n = c(0, 0), 
  Proportion = c(0, 0)
)

prop_rq3b <- bind_rows(prop_rq3b, missing3b)
```

Cross-Tab

```{r}
prop_rq3b |> 
  select(!Proportion) |> 
  pivot_wider(
    names_from = Specific_Collective, 
    values_from = n
  ) |> 
  gt() |> 
  gtsave("RQ3b.png", path = '/Users/lukefischer/Desktop')

```

Data Visualization

```{r}
RQ3bplot <- resat2 |>
  mutate(Specific_Collective = as.factor(Specific_Collective)) |> 
  mutate(Specific_Collective = fct_recode(Specific_Collective, 
                                          "The Trump-Administration" = "The Trump-Administration", 
                                          "Other Collectives" = "Other Collectives (e.g. Other Countries, Other Political Groups, NGOs, Public Enterprises, International Governing Institutions)", 
                                          
                                          "Conservatives" = "Conservative: Republicans/Right-wing ideologists", 
                                          "National Government Agencies" = "National Government Agencies (e.g., intelligence agencies, government departments like the department of justice)",
                                          "USA" = "USA"
                                          ))  |> 
  filter(Evaluation == "Positive" & Target == "Collective") |> 
  ggplot(aes(x = Time_Stamp, fill = fct_infreq(Specific_Collective))) + 
  geom_bar(position= "dodge",  width = 0.4) +
  #scale_fill_discrete(labels = 
                        #c()) +
  labs(
    title = "RQ3b", 
    x = "Inauguration", 
    fill = "Collectives"
  )+
  theme(plot.title.position = "plot", 
        legend.key.width = unit(1, 'cm'), 
        legend.key.height = unit(0.2, 'cm'))


ggsave("RQ3bplot.png", plot = RQ3aplot, path = '/Users/lukefischer/Desktop', width = 8, height= 3, units = "in")
```

Gini Coefficient Before and After

```{r}
lorenz_pos_before_col <- prop_rq3b |> 
  group_by(Time_Stamp) |> 
  filter(Time_Stamp == "Before") |> 
  ungroup() |> 
  arrange(n) |> 
  select(n) 

gini_pos_before_col <- lorenz_pos_before_col |> 
  pull(n)
  
w_neg_before_ind <- c(1, 1, 1, 0.2, 1)

Gini(gini_pos_before_col, weights = w_neg_before_ind, conf.level = 0.95, R = 10000)

lorenz_pos_after_col <- prop_rq3b |> 
  group_by(Time_Stamp) |> 
  filter(Time_Stamp == "After") |> 
  ungroup() |> 
  arrange(n) |> 
  select(n) 
  
gini_pos_after_col <- lorenz_pos_after_col |> 
  pull(n)

w_neg_after_ind <- c(1, 1, 1, 0.2, 1)

Gini(gini_pos_after_col,weights = w_neg_after_ind, conf.level = 0.95, R = 10000)
```

Lorenz Curves Overlayed

```{r}
lorenz(lorenz_pos_before_col, lc.col= "violet")

lorenz(lorenz_pos_after_col, add.lc = TRUE)
```

## RQ4a

**To what extent does the proportional distribution of targets for positive responsibility attributions vary?**

Proportional Indicator

```{r}
resat2 |> 
  filter(Evaluation == "Positive") |> 
  group_by(Time_Stamp) |> 
  count(Target) |>
  mutate(Proportion = n/sum(n))
```

Cross Tab

```{r}
resat2 |> 
  filter(Evaluation == "Positive") |> 
  group_by(Time_Stamp) |> 
  count(Target) |> 
  ungroup() |> 
  pivot_wider(
    names_from = Target, 
    values_from = n
  )|> 
  gt() |> 
  gtsave("RQ4a.png", path = '/Users/lukefischer/Desktop')
```

Visualization

```{r}
RQ4aplot<- resat2 |> 
  filter(Evaluation == "Positive") |> 
  ggplot(aes(x = Time_Stamp, fill = Target)) + 
  geom_bar(position= "fill",  width = 0.4) + 
  coord_flip()+ 
  labs(
    title = "RQ4a",
    x = "Inauguration", 
    y = "Proportion" 
  ) +
  scale_fill_brewer(palette = "Set2")+
  theme(plot.title.position = "plot",           
        legend.key.width = unit(1, 'cm'), 
        legend.key.height = unit(0.2, 'cm'))

ggsave("RQ4aplot.png", plot = RQ4aplot, path = '/Users/lukefischer/Desktop', width = 8, height= 3, units = "in")
```

## RQ4b

**To what extent does the proportional distribution of targets for negative responsibility attributions vary?**

Proportional Indicator

```{r}
resat2 |> 
  filter(Evaluation == "Negative") |> 
  group_by(Time_Stamp) |> 
  count(Target) |>
  mutate(Proportion = n/sum(n))
```

Cross Tab

```{r}
resat2 |> 
  filter(Evaluation == "Negative") |> 
  group_by(Time_Stamp) |> 
  count(Target) |> 
  ungroup() |> 
  pivot_wider(
    names_from = Target, 
    values_from = n
  )|> 
  gt() |> 
  gtsave("RQ4b.png", path = '/Users/lukefischer/Desktop')
```

Visualization

```{r}
RQ4bplot<- resat2 |> 
  filter(Evaluation == "Negative") |> 
  ggplot(aes(x = Time_Stamp, fill = Target)) + 
  geom_bar(position= "fill",  width = 0.4) + 
  coord_flip()+ 
  labs(
    title = "RQ4b",
    x = "Inauguration", 
    y = "Proportion" 
  ) +
  scale_fill_brewer(palette = "Set2")+
  theme(plot.title.position = "plot",           
        legend.key.width = unit(1, 'cm'), 
        legend.key.height = unit(0.2, 'cm'))

ggsave("RQ4bplot.png", plot = RQ4bplot, path = '/Users/lukefischer/Desktop', width = 8, height= 3, units = "in")
```

## RQ5a

**To what extent does the proportional distribution of voting issues for positive responsibility attributions vary?**

Proportional Indicator

```{r}
resat2 |> 
  filter(Evaluation == "Positive") |> 
  group_by(Time_Stamp) |> 
  count(Topic) |>
  mutate(Proportion = n/sum(n))

```

Cross Tab

```{r}
resat2 |> 
  filter(Evaluation == 1) |> 
  group_by(Time_Stamp) |> 
  count(Topic) |> 
  ungroup() |> 
  pivot_wider(
    names_from = Topic, 
    values_from = n
  ) |> 
  gt() |> 
  gtsave("RQ5a.png", path = '/Users/lukefischer/Desktop')
```

Data Visualization

```{r}
RQ5aplot <- resat2 |> 
  filter(Evaluation == "Positive") |> 
  ggplot(aes(x = Time_Stamp, fill = Topic)) + 
  geom_bar(position= "fill",  width = 0.4) + 
  coord_flip()+ 
  labs(
    title = "RQ5a",
    x = "Inauguration", 
    y = "Proportion" 
  ) +
  scale_fill_brewer(palette = "Set2") +
  annotate(
    geom = "label", 
    x = "After", 
    y = 0.0835, 
    label = "16,7%", 
    hjust = "center", 
    size = 3
  ) + 
  annotate(
    geom = "label", 
    x = "After", 
    y = 0.3455,
    label = "35,7%", 
    hjust = "center", 
    size = 3
  )+ 
  annotate(
    geom = "label", 
    x = "After", 
    y = 0.631,
    label = "21,4%", 
    hjust = "center", 
    size = 3
  )+ 
  annotate(
    geom = "label", 
    x = "After", 
    y = 0.869,
    label = "26,2%", 
    hjust = "center", 
    size = 3
  )+ 
  annotate(
    geom = "label", 
    x = "Before", 
    y = 0.03675,
    label = "7,35%", 
    hjust = "center", 
    size = 3
  )+ 
  annotate(
    geom = "label", 
    x = "Before", 
    y = 0.434,
    label = "72,1%", 
    hjust = "center", 
    size = 3
  ) +
  annotate(
    geom = "label", 
    x = "Before", 
    y = 0.81655,
    label = "4,41%", 
    hjust = "center", 
    size = 3
  )+ 
  annotate(
    geom = "label", 
    x = "Before", 
    y = 0.9196,
    label = "16,2%", 
    hjust = "center", 
    size = 3
  ) +
  theme(plot.title.position = "plot",           
        legend.key.width = unit(1, 'cm'), 
        legend.key.height = unit(0.2, 'cm'))

ggsave("RQ5aplot.png", plot = RQ5aplot, path = '/Users/lukefischer/Desktop', width = 8, height= 3, units = "in")
```

Gini Coefficient Before and After

```{r}
lorenz_top_before_pos <- resat2 |> 
  filter(Evaluation == "Positive") |> 
  group_by(Time_Stamp) |> 
  filter(Time_Stamp == "Before") |> 
  count(Topic) |>
  ungroup() |> 
  select(n) |> 
  arrange(n)

gini_top_before_pos<- lorenz_top_before_pos |> 
  pull(n)

Gini(gini_top_before_pos, conf.level = 0.95, R = 10000)

lorenz_top_after_pos <- resat2 |> 
  filter(Evaluation == "Positive") |> 
  group_by(Time_Stamp) |> 
  filter(Time_Stamp == "After") |> 
  count(Topic) |>
  ungroup() |> 
  select(n) |> 
  arrange(n)

gini_top_after_pos<- lorenz_top_after_pos |> 
  pull(n)

Gini(gini_top_after_pos, conf.level = 0.95, R = 10000)


```

Lorenz Curves Overlayed

```{r}
lorenz(lorenz_top_before_pos, lc.col= "violet")

lorenz(lorenz_top_after_pos, add.lc = TRUE)
```

Robustness Check Gini

```{r}
# Interpretation: probability that two randomly responsibility attributions are about different topics - higher probability means more diversity 

### Function requires Proportion and only before or after
elf <- function(df) {
  df <- df |> mutate(Proportion2 = Proportion^2)
  1 - sum(df$Proportion2)
}

###Custom function in order to bootstrap
elf_boot <- function(df, indices) {
  sample_data <- df[indices, ]
  elf(sample_data)
}


rbbefore1 <-resat2 |> 
  filter(Evaluation == "Positive") |> 
  group_by(Time_Stamp) |> 
  count(Topic) |>
  mutate(Proportion = n/sum(n)) |> 
  filter(Time_Stamp == "Before") |> 
  ungroup()


factbeforepos <- boot(data = rbbefore1, statistic = elf_boot, R=1000) 
factbeforepos
boot.ci(factbeforepos)


rbafter1 <-resat2 |> 
  filter(Evaluation == "Positive") |> 
  group_by(Time_Stamp) |> 
  count(Topic) |>
  mutate(Proportion = n/sum(n)) |> 
  filter(Time_Stamp == "After") |> 
  ungroup()

factafterpos <- boot(data = rbafter1, statistic = elf_boot, R=1000) 
factafterpos
boot.ci(factafterpos)

```

## RQ5b

Proportional Indicator

```{r}
resat2 |> 
  filter(Evaluation == "Negative") |> 
  group_by(Time_Stamp) |> 
  count(Topic) |>
  mutate(Proportion = n/sum(n))
```

Cross Tab

```{r}
resat2 |> 
  filter(Evaluation == "Negative") |> 
  group_by(Time_Stamp) |> 
  count(Topic) |> 
  ungroup() |> 
  pivot_wider(
    names_from = Topic, 
    values_from = n
  ) |> 
  gt() |> 
  gtsave("RQ5b.png", path = '/Users/lukefischer/Desktop')
```

Visualization

```{r}
RQ5bplot <- resat2 |> 
  filter(Evaluation == "Negative") |> 
  ggplot(aes(x = Time_Stamp, fill = Topic)) + 
  geom_bar(position= "fill",  width = 0.4) + 
  coord_flip()+ 
  labs(
    title = "RQ5b",
    x = "Inauguration", 
    y = "Proportion" 
  ) +
  scale_fill_brewer(palette = "Set2") +
  annotate(
    geom = "label", 
    x = "After", 
    y = 0.1295, 
    label = "25,9%", 
    hjust = "center", 
    size = 3
  ) + 
  annotate(
    geom = "label", 
    x = "After", 
    y = 0.5555,
    label = "59,3%", 
    hjust = "center", 
    size = 3
  )+ 
  annotate(
    geom = "label", 
    x = "After", 
    y = 0.9075,
    label = "11,1%", 
    hjust = "center", 
    size = 3
  )+ 
  annotate(
    geom = "label", 
    x = "After", 
    y = 0.9815,
    label = "3,7%", 
    hjust = "center", 
    size = 3
  )+ 
  annotate(
    geom = "label", 
    x = "Before", 
    y = 0.09,
    label = "18%", 
    hjust = "center", 
    size = 3
  )+ 
  annotate(
    geom = "label", 
    x = "Before", 
    y = 0.4835,
    label = "60,7%", 
    hjust = "center", 
    size = 3
  ) +
  annotate(
    geom = "label", 
    x = "Before", 
    y = 0.81965,
    label = "6,56%", 
    hjust = "center", 
    size = 3
  )+ 
  annotate(
    geom = "label", 
    x = "Before", 
    y = 0.9266,
    label = "14,8%", 
    hjust = "center", 
    size = 3
  ) +
  theme(plot.title.position = "plot",           
        legend.key.width = unit(1, 'cm'), 
        legend.key.height = unit(0.2, 'cm'))


ggsave("RQ5bplot.png", plot = RQ5bplot, path = '/Users/lukefischer/Desktop', width = 8, height= 3, units = "in")
```

Gini Coefficient Before and After

```{r}
lorenz_before_neg_top <- resat2 |> 
  filter(Evaluation == "Negative") |> 
  group_by(Time_Stamp) |> 
  count(Topic) |> 
  ungroup() |> 
  filter(Time_Stamp=="Before") |> 
  select(n) |> 
  arrange(n)
  

lorenz_after_neg_top <- resat2 |> 
  filter(Evaluation == "Negative") |> 
  group_by(Time_Stamp) |> 
  count(Topic) |> 
  ungroup() |> 
  filter(Time_Stamp=="After") |> 
  select(n) |> 
  arrange(n)

Gini_before_neg_top <- lorenz_before_neg_top |> 
  pull(n)

Gini_after_neg_top <- lorenz_after_neg_top |> 
  pull(n)

Gini(Gini_before_neg_top, conf.level = 0.95, R = 10000, type = "bca")

Gini(Gini_after_neg_top, conf.level = 0.95, R = 10000, type = "bca")

```

Lorenz Curves Overlayed

```{r}
lorenz(lorenz_before_neg_top,  lc.col= "violet")

lorenz(lorenz_after_neg_top, add.lc = TRUE)
```

Robustness Check Gini

```{r}
rbbefore2 <- resat2 |> 
  filter(Evaluation == "Negative") |> 
  group_by(Time_Stamp) |> 
  count(Topic) |> 
  ungroup() |> 
  filter(Time_Stamp=="Before") |> 
  mutate(Proportion = n/sum(n))

factbeforeneg <- boot(data=rbbefore2, statistic = elf_boot, R = 10000)
factbeforeneg
boot.ci(factbeforeneg)

rbafter2 <- resat2 |> 
  filter(Evaluation == "Negative") |> 
  group_by(Time_Stamp) |> 
  count(Topic) |> 
  ungroup() |> 
  filter(Time_Stamp=="After") |> 
  mutate(Proportion = n/sum(n))

factafterneg <- boot(data=rbafter2, statistic = elf_boot, R = 10000)
factbeforeneg
boot.ci(factafterneg)

```
